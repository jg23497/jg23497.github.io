/*! For license information please see c1a433cd.96f2535e.js.LICENSE.txt */
"use strict";(self.webpackChunkjgulan=self.webpackChunkjgulan||[]).push([[951],{2238:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>f,contentTitle:()=>p,default:()=>y,frontMatter:()=>d,metadata:()=>r,recipe:()=>g,toc:()=>v});const r=JSON.parse('{"permalink":"/2025/04/27/leveraging-the-wake-lock-api-for-uninterrupted-web-content","source":"@site/blog/2025/04-27-leveraging-the-wake-lock-api-for-uninterrupted-web-content/index.mdx","title":"Leveraging the Wake Lock API for uninterrupted web content","description":"It is a familiar frustration: following a recipe or assembly instructions on a mobile device, only to have the screen dim mid-task. Needing to","date":"2025-04-27T00:00:00.000Z","tags":[{"inline":true,"label":"engineering","permalink":"/tags/engineering"}],"readingTime":3.25,"hasTruncateMarker":false,"authors":[],"frontMatter":{"title":"Leveraging the Wake Lock API for uninterrupted web content","tags":["engineering"],"unlisted":true},"unlisted":true}');var o=n(4848),i=n(8453),a=n(6540);function c(){c=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",l=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var i=t&&t.prototype instanceof y?t:y,a=Object.create(i.prototype),c=new W(r||[]);return o(a,"_invoke",{value:S(e,n,c)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p="suspendedStart",f="suspendedYield",g="executing",v="completed",m={};function y(){}function w(){}function x(){}var b={};u(b,a,(function(){return this}));var k=Object.getPrototypeOf,j=k&&k(k(O([])));j&&j!==n&&r.call(j,a)&&(b=j);var L=x.prototype=y.prototype=Object.create(b);function E(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function P(e,t){function n(o,i,a,c){var l=d(e[o],e,i);if("throw"!==l.type){var s=l.arg,u=s.value;return u&&"object"==typeof u&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,a,c)}),(function(e){n("throw",e,a,c)})):t.resolve(u).then((function(e){s.value=e,a(s)}),(function(e){return n("throw",e,a,c)}))}c(l.arg)}var i;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return i=i?i.then(o,o):o()}})}function S(t,n,r){var o=p;return function(i,a){if(o===g)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:e,done:!0}}for(r.method=i,r.arg=a;;){var c=r.delegate;if(c){var l=N(c,r);if(l){if(l===m)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===p)throw o=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=g;var s=d(t,n,r);if("normal"===s.type){if(o=r.done?v:f,s.arg===m)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(o=v,r.method="throw",r.arg=s.arg)}}}function N(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,N(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var i=d(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function W(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function O(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(typeof t+" is not iterable")}return w.prototype=x,o(L,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:w,configurable:!0}),w.displayName=u(x,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,u(e,s,"GeneratorFunction")),e.prototype=Object.create(L),e},t.awrap=function(e){return{__await:e}},E(P.prototype),u(P.prototype,l,(function(){return this})),t.AsyncIterator=P,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new P(h(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=O,W.prototype={constructor:W,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(I),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return c.type="throw",c.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var l=r.call(a,"catchLoc"),s=r.call(a,"finallyLoc");if(l&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;I(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:O(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function l(e,t,n,r,o,i,a){try{var c=e[i](a),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,o)}const s=function(e){var t=e.label,n="undefined"!=typeof navigator&&"wakeLock"in navigator,r=(0,a.useState)(!1),i=r[0],s=r[1],u=(0,a.useRef)(null);if(!n)return null;var h=function(){var e,t=(e=c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==n){e.next=2;break}return e.abrupt("return");case 2:if(i){e.next=16;break}return e.prev=3,e.next=6,navigator.wakeLock.request("screen");case 6:u.current=e.sent,u.current.addEventListener("release",(function(){s(!1)})),e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(3),alert(e.t0.message),e.abrupt("return");case 14:e.next=19;break;case 16:return e.next=18,null==(t=u.current)?void 0:t.release();case 18:u.current=null;case 19:s(!i);case 20:case"end":return e.stop()}}),e,null,[[3,10]])})),function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){l(i,r,o,a,c,"next",e)}function c(e){l(i,r,o,a,c,"throw",e)}a(void 0)}))});return function(){return t.apply(this,arguments)}}();return(0,o.jsxs)("label",{id:"wake-lock-label",children:[(0,o.jsx)("span",{children:t}),(0,o.jsx)("input",{id:"wake-lock-toggle",type:"checkbox",role:"switch",checked:i,"aria-checked":i,onChange:h})]})},u=e=>{let{recipe:t}=e;const[n,r]=(0,a.useState)(1);return(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{id:"scale-selection",children:(0,o.jsxs)("label",{children:[(0,o.jsx)("span",{children:"Scale"}),(0,o.jsxs)("select",{name:"scale",value:n,onChange:e=>{r(Number(e.target.value))},className:"scale-select",children:[(0,o.jsx)("option",{value:"1",children:"Original"}),(0,o.jsx)("option",{value:"0.5",children:"0.5x"}),(0,o.jsx)("option",{value:"0.75",children:"0.75x"}),(0,o.jsx)("option",{value:"2",children:"2x"}),(0,o.jsx)("option",{value:"3",children:"3x"}),(0,o.jsx)("option",{value:"4",children:"4x"})]})]})}),(0,o.jsx)("hr",{}),(0,o.jsx)("div",{id:"recipe",children:t.map(((e,t)=>((e,t)=>(0,o.jsxs)("section",{className:"section",children:[(0,o.jsx)("h2",{children:e.name}),(0,o.jsx)("ul",{children:e.ingredients.map(((e,t)=>(0,o.jsxs)("li",{children:[(e.quantity*n).toLocaleString()," ",e.unit," ",e.name,e.note&&(0,o.jsx)("div",{children:(0,o.jsx)("i",{children:e.note})})]},t)))})]},t))(e,t)))})]})},h=u,d={title:"Leveraging the Wake Lock API for uninterrupted web content",tags:["engineering"],unlisted:!0},p=void 0,f={authorsImageUrls:[]},g=[{name:"Pizza dough",ingredients:[{quantity:500,unit:"gram(s)",name:"plain white flour",note:"ideally type 00"},{quantity:1,unit:"tsp(s)",name:"salt"},{quantity:4,unit:"gram(s)",name:"fast-action dried yeast"},{quantity:280,unit:"millilitre(s)",name:"warm water"},{quantity:2,unit:"teaspoon(s)",name:"olive oil",note:"preferably extra virgin"}]}],v=[{value:"How to",id:"how-to",level:4},{value:"Example",id:"example",level:4},{value:"References",id:"references",level:4}];function m(e){const t={a:"a",code:"code",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.p,{children:"It is a familiar frustration: following a recipe or assembly instructions on a mobile device, only to have the screen dim mid-task. Needing to\nregularly tap the screen just to keep it active disrupts your flow, particularly if your hands are full. Temporarily adjusting the system-wide\nscreen timeout is not convenient either."}),"\n",(0,o.jsx)(t.p,{children:"Fortunately, the Screen Wake Lock API provides a solution, at least for in-browser content. The API was developed through collaboration between\nthe Chrome team and the Web Platform Incubator Community Group (WICG) and is part of the web standards. It offers a great improvement over the\npreviously common and hacky solutions that involved embedding a silent audio file or perhaps a hidden video file within a page to trick the browser\ninto maintaining focus. Despite being\xa0broadly supported by modern web browsers, the API is generally slept on, not being used by many of the websites\nthat would benefit from it."}),"\n",(0,o.jsx)(t.h4,{id:"how-to",children:"How to"}),"\n",(0,o.jsx)(t.p,{children:"Older browser versions will not support the Wake Lock API and it is also only available when HTTPS is being used. Therefore, it is\nworth checking for support before attempting to obtain the lock, or even showing the user the option to do so."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-js",children:"// Query the Navigator interface for Wake Lock availability.\nlet isSupported = 'wakeLock' in navigator;\n"})}),"\n",(0,o.jsx)(t.p,{children:"Assuming the feature is availabile, we can proceed to attempt to obtain the wake lock. Even if the feature is available,\nthe browser may still refuse to honour the request if perhaps the device's battery is low, and so it is worth wrapping the\nfollowing in a try-catch statement."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-js",children:"let wakeLock = await navigator.wakeLock.request('screen')\n"})}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"request"})," method returns an instance of WakeLockSentinel. To release the wake lock, simply call ",(0,o.jsx)(t.code,{children:"wakeLock.release()"}),"."]}),"\n",(0,o.jsx)(t.p,{children:'Note that the wake lock will also be automatically released if in certain cases, like if the user switches tabs, so I\nwould recommend configuring an event listener for the the WakeLockSentinel\'s "release" event.'}),"\n",(0,o.jsx)(t.h4,{id:"example",children:"Example"}),"\n",(0,o.jsxs)(t.p,{children:["Wrapping this all up along with HTML and CSS for presentation, let's create a React component for fun, ",(0,o.jsx)(t.a,{href:"https://github.com/jg23497/react-wake-lock-toggle",children:"react-wake-lock-toggle"}),",\nand distribute it as an ",(0,o.jsx)(t.a,{href:"https://www.npmjs.com/package/@jgulan/react-wake-lock-toggle",children:"NPM package"}),". We can use it like so, providing a label of our choice:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-js",children:'<WakeLockToggle label="Prevent screen timeout" />\n'})}),"\n",(0,o.jsxs)(t.p,{children:["Credit to ",(0,o.jsx)(t.a,{href:"https://alvaromontoro.com/blog/68017/creating-a-css-only-toggle-switch",children:"Alvaro Montoro"}),' for thoughts on creating\naccessible and semantic toggle switches, which I incorporate here. With this approach, we use a checkbox with the "switch" role, correctly providing\ntwo states rather than three (a regular checkbox can be unchecked, checked and indeterminate). The element is printable, can be tabbed to and toggled\nusing the keyboard, and screen readers will correctly read aloud ',(0,o.jsx)(t.code,{children:"label"})," followed by the ",(0,o.jsx)(t.code,{children:"state"}),', e.g "Prevent screen timeout on".']}),"\n",(0,o.jsx)(t.p,{children:"My favourite homemade pizza dough recipe follows, made easier to read using our new React component. While we are here,\nwe can also allow the user to dynamically scale the ingredients according to their preference (we are building on React foundations after all)."}),"\n",(0,o.jsxs)("div",{style:{border:"1px solid #ccc",padding:"1em",borderRadius:"10px"},children:[(0,o.jsx)("div",{children:(0,o.jsx)(s,{label:"Prevent screen timeout"})}),(0,o.jsx)(h,{recipe:g}),(0,o.jsx)(t.p,{children:"Steps:"}),(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:"Mix flour, salt, yeast."}),"\n",(0,o.jsx)(t.li,{children:"Add water, oil; mix, knead for around 5 minutes."}),"\n",(0,o.jsx)(t.li,{children:"Allow to rise for ideally for 1-2 hours."}),"\n",(0,o.jsx)(t.li,{children:"Shape, add sauce and toppings then bake at a high temperature."}),"\n"]})]}),"\n",(0,o.jsx)(t.h4,{id:"references",children:"References"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/WakeLock",children:"MDN Web Docs: WakeLock"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"https://developer.chrome.com/docs/capabilities/web-apis/wake-lock",children:"Chrome Developer Documentation: Stay awake with the Screen Wake Lock API"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"https://alvaromontoro.com/blog/68017/creating-a-css-only-toggle-switch",children:"Alvaro Montoro: Creating a CSS-Only Toggle Switch"})}),"\n"]})]})}function y(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(m,{...e})}):m(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>c});var r=n(6540);const o={},i=r.createContext(o);function a(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);